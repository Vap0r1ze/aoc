Lines ← ⊜□≠@\n. &fras "input.txt"
SubstrMask ← /↥≡↻⊙¤¯⇡⊃⧻⌕
Colors ← {"red" "green" "blue"}

ParseSubgame ← /+ ≡(⍜⊡; ⊙: °[⊙∘]⇌) :¤[0 0 0]
⊐≡(⊐≡(⊜□¬SubstrMask", ".) ⊜□¬SubstrMask"; ". ↘+2⊗@:.) Lines
≡(
  □≡(
    ParseSubgame°□ □≡([⊙∘] ⊙(⊗□:Colors) ⋕ ∩°□°[⊙∘] ⊜□≠@ .°□)°□
  )°□
)
Games ←

# Part 1
UpperBound ← [12 13 14]
/+ +1⊚ =3≡(/+) ≡(≤UpperBound) ⊐≡(/↥) Games

# Part 2
/+ ⊐≡(/×/↥) Games
